on: [push, pull_request]

name: deploy-shiny

jobs:
  deploy-shiny:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: r-lib/actions/setup-r@master
        with:
          r-version: '4.1.2'
      - name: Install shiny and deploy
        run: |
          sudo apt-get install -y libcurl4-openssl-dev libxml2-dev libssl-dev cmake libnlopt-dev
          Rscript -e "install.packages('versions'); library(versions); install.versions(c('zoo','listenv', 'parallelly', 'future', 'globals', 'future.apply', 'progressr', 'SQUAREM', 'lava', 'prodlim', 'bit', 'ps', 'evaluate', 'highr', 'xfun', 'proxy', 'iterators', 'ipred', 'timeDate', 'rematch', 'bit64', 'prettyunits', 'processx',  'sys', 'cpp11', 'pkgconfig', 'numDeriv', 'knitr', 'sp', 'minqa', 'nloptr', 'e1071', 'ModelMetrics', 'plyr', 'pROC', 'recipes', 'reshape2', 'backports', 'assertthat', 'blob', 'DBI', 'gargle', 'uuid', 'cellranger', 'ids', 'rematch2', 'utf8', 'vroom', 'tzdb', 'progress', 'callr', 'rmarkdown', 'selectr', 'stringi', 'jquerylib', 'rappdirs', 'askpass', 'scales', 'httr', 'magrittr', 'digest', 'viridisLite', 'base64enc', 'htmltools', 'htmlwidgets', 'tidyr', 'vctrs', 'tibble', 'lazyeval', 'crosstalk', 'purrr', 'data.table', 'promises', 'fs', 'Rcpp', 'pbkrtest', 'quantreg', 'maptools', 'lme4', 'matrixStats', 'caret', 'ggrepel', 'ggsci', 'ggsignif', 'gridExtra', 'glue', 'polynom', 'rstatix', 'broom', 'crayon', 'dbplyr', 'dtplyr', 'forcats', 'googledrive', 'googlesheets4', 'haven', 'hms', 'lubridate', 'modelr', 'pillar', 'readr', 'readxl', 'reprex', 'rstudioapi', 'rvest', 'stringr', 'xml2', 'ellipsis', 'generics', 'lifecycle', 'R6', 'withr', 'httpuv', 'mime', 'xtable', 'fontawesome', 'sourcetools', 'later', 'fastmap', 'commonmark', 'bslib', 'cachem', 'sass', 'curl', 'openssl', 'packrat', 'yaml', 'hash', 'plotly', 'shinyFiles', 'MatrixModels', 'RcppArmadillo', 'RcppEigen', 'SparseM', 'abind', 'car', 'carData', 'conquer', 'cowplot', 'corrplot', 'ggpubr', 'RColorBrewer', 'tidyverse', 'cli', 'viridis', 'dplyr', 'colorspace', 'fansi', 'farver', 'ggplot2', 'gtable', 'isoband', 'labeling', 'munsell', 'shiny', 'shinyWidgets', 'rsconnect'), c('1.8-9', '0.8.0', '1.30.0', '1.23.0', '0.14.0', '1.8.1', '0.10.0', '2021.1', '1.6.10', '2019.11.13', '4.0.4', '1.6.0', '0.14', '0.9', '0.29', '0.4-26', '1.0.13', '0.9-12', '3043.102', '1.0.1', '4.0.5', '1.1.1', '3.5.2', '3.4', '0.4.2', '2.0.3', '2016.8-1.1', '1.37', '1.4-6', '1.2.4', '1.2.2.3', '1.7-9', '1.2.2.2', '1.8.6', '1.18.0', '0.1.17', '1.4.4', '1.4.1', '0.2.1', '1.2.2', '1.1.2', '1.2.0', '1.0-3', '1.1.0', '1.0.1', '2.1.2', '1.2.2', '1.5.7', '0.2.0', '1.2.2', '3.7.0', '2.11', '0.4-2', '1.7.6', '0.1.4', '0.3.3', '1.1', '1.1.1', '1.4.2',  '2.0.1', '0.6.29', '0.4.0', '0.1-3', '0.5.2', '1.5.4', '1.1.4', '0.3.8', '3.1.6', '0.2.2', '1.2.0', '0.3.4', '1.14.2', '1.2.0.1', '1.5.2', '1.0.8', '0.5.1', '5.86', '1.1-2', '1.1-27.1', '0.61.0', '6.0-90', '0.9.1', '2.9', '0.6.3', '2.3', '1.6.0', '1.4-0', '0.7.0', '0.7.11', '1.4.2', '2.1.1', '1.2.0', '0.5.1', '2.0.0', '1.0.0', '2.4.3', '1.1.1', '1.8.0', '0.1.8', '1.6.4', '1.3.1', '1.3.1', '2.0.1', '0.13', '1.0.2', '1.4.0', '1.3.3', '0.3.2', '0.1.1', '1.0.1', '2.5.1', '2.4.3', '1.6.5', '0.12', '1.8-4', '0.2.2', '0.1.7', '1.3.0', '1.1.0', '1.7', '0.3.1', '1.0.6', '0.4.0', '4.3.2', '1.4.6', '0.7.0', '2.2.1', '2.2.6.1', '4.10.0', '0.9.1', '0.5-0', '0.10.7.5.0', '0.3.3.9.1', '1.81', '1.4-5', '3.0-12', '3.0-5', '1.2.1', '1.1.1', '0.92', '0.4.0', '1.1-2', '1.3.1', '3.1.0', '0.6.2', '1.0.7', '2.0-2', '1.0.2', '2.1.0', '3.3.5', '0.3.0', '0.2.5', '0.4.2', '0.5.0', '1.7.1', '0.6.3', '0.8.25'))"

# ; rsconnect::setAccountInfo(name='calorimetry', token=${{secrets.SHINYAPPS_TOKEN}}, secret=${{secrets.SHINYAPPS_SECRET}}); rsconnect::deployApp(appName = 'calorimetry')"
